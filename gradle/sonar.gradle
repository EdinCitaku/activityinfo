
apply plugin: "sonar-runner"


sonarRunner {
    sonarProperties {
        property "sonar.projectName", "ActivityInfo"
        property "sonar.host.url", "http://sonar.bedatadriven.com"
        property "sonar.jdbc.url", "jdbc:mysql://sonar.bedatadriven.com/sonardb"
        property "sonar.jdbc.driverClassName", "com.mysql.jdbc.Driver"
        property "sonar.jdbc.username", "sonar"
        property "sonar.jdbc.password", sonarDatabasePassword
        
    //    property "sonar.jacoco.itReportPath", jacocoAcceptanceDataFile
        property "sonar.genericcoverage.itReportPaths", gwtAcceptanceDataFile 
    }
}

buildscript {
    repositories {
        mavenCentral()
    }
}

repositories {
    mavenCentral()
}

// Ensure that we run the acceptanceTest with coverage enabled
// to ensure that we have the coverage data to provide sonar
tasks.sonarRunner.dependsOn ':tests:acceptance:acceptanceTestCoverage'

// ONLY when sonar is enabled, ignore test failures when they occur 
// and turn on instrumentation of tests
project.gradle.taskGraph.whenReady { taskGraph ->
    if (taskGraph.allTasks.find { it.name == "sonarRunner" }) {
        project.tasks.withType(Test).each { Test test ->
            test.ignoreFailures = true
            test.jacoco.enabled = true
        }
    }
}